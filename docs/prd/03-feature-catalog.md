# 03. Каталог животных и Поиск (Feature Spec)

Этот модуль описывает логику представления животных, их статусов и алгоритмы поиска (стандартного и интеллектуального).

## 1. Карточка животного (Data Model)
Каждое животное — это основная сущность системы.

### Основные атрибуты
* **Имя:** Текстовое поле (e.g., "Мила").
* **Вид:** Enum (DOG, CAT).
* **Пол:** Enum (MALE, FEMALE).
* **Возраст:**
    * В БД хранится `birthDate` (примерная дата рождения).
    * На фронтенде отображается вычисляемое значение: "3 месяца", "2 года".
    * Градации для фильтра: Щенок/Котенок (<1 года), Молодой (1–3), Взрослый (3–7), Пожилой (7+).
* **Размер:** Enum (SMALL, MEDIUM, LARGE). Важно для собак (в квартиру/в дом).
* **Шерсть/Окрас:** Enum (SHORT, LONG, WIREHAIRED / BLACK, WHITE, etc.) — опционально.
* **Характер (Tags):** Массив тегов для быстрого поиска (e.g., `["Спокойный"`, `"Ладит с детьми"`, `"Для охраны"]`).
* **Медицинский статус:** Флаги (Стерилизован, Привит, Обработан).

### Контент (Media & Story)
* **Аватар:** Главное фото для превью (обязательно оптимизированное WebP).
* **Галерея:** До 20 фото/видео.
* **История:** Текстовое поле (Rich Text). Эмоциональное описание судьбы.
* **Векторное описание (AI):** Скрытое поле. Автоматически генерируемый эмбеддинг на основе истории и тегов для работы AI-поиска.

## 2. Машина состояний (State Machine)
Животное может находиться в одном из следующих статусов. Статус определяет видимость карточки на сайте.

| Статус | Видимость на сайте | Описание |
| :--- | :---: | :--- |
| **DRAFT** | Только Админ | Черновик, карточка заполняется волонтером. |
| **PUBLISHED** | Публично | Активный поиск дома. Кнопки "Хочу забрать", "Опекун". |
| **ON_TREATMENT** | Публично | "На лечении". Кнопка "Хочу забрать" скрыта, акцент на "Помочь на лечение". |
| **ON_PROBATION** | Скрыто (или маркер "Бронь") | Испытательный срок. Животное уехало, но документы окончательно не подписаны. |
| **ADOPTED** | Раздел "Счастливчики" | Животное нашло дом. Отображается в историях успеха. |
| **RAINBOW** | Скрыто (Архив) | "На радуге" (умерло). Доступно только в админке для истории. |

## 3. Логика поиска

### 3.1. Классическая фильтрация
Пользователь выбирает параметры чекбоксами.
* **Логика:** `AND` между группами, `OR` внутри группы.
* *Пример:* (Собака) AND (Мальчик OR Девочка) AND (До 1 года).

### 3.2. Умный поиск (AI Search)
Поле ввода с плейсхолдером: *"Ищу спокойную рыжую кошку, которая не дерет обои"*.

**Алгоритм работы:**
1.  **Input:** Пользователь вводит текст.
2.  **Processing:** Бэкенд отправляет текст в `SearchService`.
3.  **Vectorization:** Текст преобразуется в вектор (embedding) через OpenAI API / локальную модель.
4.  **Comparison:** БД (PostgreSQL + pgvector) ищет ближайшие векторы описаний животных (Cosine Similarity).
5.  **Ranking:** Результаты сортируются по релевантности (Similarity Score).
6.  **Output:** Выдача топ-5 наиболее подходящих карточек с пометкой "AI рекомендует".
PostgreSQL Full-Text Search (tsvector)

## 4. Сортировка и выдача
* **По умолчанию:** Сначала `URGENT` (кому срочно нужен дом), затем `NEWEST` (новые поступления).
* **Пагинация:** Infinite Scroll.

## 5. UI Элементы карточки
* **Бейджи (Labels):** "Срочно", "Особенный уход", "Только в дом".
* **Кнопка действия (Primary):**
    * Если статус `PUBLISHED` -> "Познакомиться" (открывает модалку анкеты/записи).
* **Кнопка помощи (Secondary):** "Стать опекуном" или "Помочь разово".