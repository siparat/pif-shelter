# ADR-004: Реализация чистой логики (Mappers and Utilities)

- **Status:** Accepted
- **Date:** 2026-02-18
- **Author:** Backend Team
- **Context:**
  При использовании NestJS (DI-based framework) возникает соблазн превращать каждую логическую единицу в `@Injectable()` сервис. Это приводит к раздуванию провайдеров в модулях, усложнению тестирования (необходимость мокать зависимости) и лишнему оверхеду на DI в рантайме.

- **Decision:**
  Мы разделяем логику на "сервисы с состоянием" и "чистые функции":
    1.  **Mappers (Static Utility Classes):** Логика, которая не требует внедрения внешних зависимостей (например, `ConfigService`, `DatabaseService`, `MailerService`) и выполняет чистые преобразования данных (превращение данных в URL, форматирование строк, маппинг Entity -> DTO), должна быть реализована в виде статических методов в обычных классах (Мапперах).
    2.  **Запрет DI для Мапперов:** Мапперы не помечаются декоратором `@Injectable` и не регистрируются в массиве `providers`. Их вызовы должны быть прямыми: `SomeMapper.process(data)`.
    3.  **Передача внешних параметров:** Если мапперу нужен параметр из конфигурации (например, `baseUrl`), он должен принимать его как аргумент метода, а не инжектить `ConfigService`. Инжекцию должен делать вызывающий (Handler или Controller).

- **Consequences:**
    - **Positive:**
        - Упрощение тестирования: тесты мапперов становятся "чистыми" (Unit Tests), не требующими `Test.createTestingModule`.
        - Снижение нагрузки на DI-контейнер NestJS.
        - Четкое разделение между "инфраструктурой/бизнесом" и "утилитами/мапперами".
    - **Negative:**
        - Вызывающий код (Handler) становится чуть длиннее из-за необходимости явно передавать параметры (например, из конфига).

- **Compliance:**
    - Код-ревьюверы должны предлагать рефакторинг сервисов-провайдеров без зависимостей в статические мапперы.
