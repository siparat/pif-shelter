# ADR-003: Межмодульное взаимодействие (Cross-Module Communication)

- **Status:** Accepted
- **Date:** 2026-02-18
- **Author:** Backend Team
- **Context:**
  В модульном монолите NestJS существует риск сильной связанности (tight coupling) между модулями, если они начинают импортировать внутренние детали реализации друг друга (например, репозитории). Это затрудняет рефакторинг, тестирование и потенциальное выделение модулей в микросервисы.

- **Decision:**
  Мы устанавливаем строгие границы взаимодействия между модулями:
    1.  **Единственная точка входа:** Модуль может предоставлять другим модулям доступ к своим данным или логике ТОЛЬКО через **Service** (Публичный API модуля).
    2.  **Изоляция инфраструктуры:** Запрещено импортировать `Repository` одного модуля в другой. Репозиторий является деталью реализации слоя данных модуля.
    3.  **Exports:** В секции `exports` модуля должен находиться только `Service`. Репозитории должны оставаться внутренними (private) провайдерами модуля.
    4.  **Альтернатива (CQRS):** Для слабосвязанного взаимодействия по-прежнему рекомендуется использовать `EventBus` (события) или `CommandBus` (если команда экспортирована в `@pif/contracts`).

- **Consequences:**
    - **Positive:**
        - Высокая степень инкапсуляции.
        - Легкость замены реализации хранилища (например, переход с БД на кэш) внутри модуля без влияния на потребителей.
        - Четкий и понятный контракт взаимодействия между частями системы.
    - **Negative:**
        - Небольшой оверхед на написание прокси-методов в сервисе, если они просто дублируют методы репозитория.

- **Compliance:**
    - Код-ревьюверы должны отклонять PR, в которых `Handler` или `Service` одного модуля импортирует `Repository` другого модуля.
